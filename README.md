# CTCP — ADLC + Multi-Agent Execution Engine

本仓库核心定位：核心 = ADLC 执行引擎（证据链 + failure bundle），把“项目实现”变成可验证、可回放、可审计的执行闭环。
- 默认路径是 **headless**（不依赖 GUI/Qt）。
- GUI 仅作为示例/可视化器，可选开启，不影响核心流程。
- find = workflow resolver（从本地 `workflow_registry/` + 历史成功记录解析最佳 workflow，不依赖联网检索）。
- 可选开启受控 web find（`resolver_plus_web`，由外部 Researcher 提供 `find_web.json`），默认仍不依赖联网。
- GUI 可选/默认挂起（不影响核心 gate）。

系统目标：
- 你只需给一个目标（Goal）
- 系统会自动拆解、执行、验收、记录
- 只有在 **必须由你决策/提供信息** 时才会提问
- 最终给你一份可回放的演示报告（trace + 可复现命令）

> 强约束入口：先读 `docs/00_CORE.md`、`AGENTS.md`、`ai_context/00_AI_CONTRACT.md`。  
> 规则冲突时以 `docs/00_CORE.md` 为准。

---

## Quick Start

最小命令（核心链路）：
```powershell
powershell -ExecutionPolicy Bypass -File scripts\verify_repo.ps1
python scripts\adlc_run.py --goal "your-goal" --force
```

1) 生成任务单（DoD/验收先行）
```powershell
python tools\ctcp_assistant.py init-task "your-goal"
```

2) （可选）生成外部调研模板（Research-first）
```powershell
python tools\ctcp_assistant.py init-externals "your-goal"
```

3) 运行“团队式”执行（默认 dry-run，会生成 Agent Packet 与演示报告）
```powershell
python tools\ctcp_team.py start "your-goal"
```

4) 运行 ADLC headless 入口（最小闭环）
```powershell
python scripts\adlc_run.py --goal "your-goal" --force
```

5) 验收（必须）：证据闭环 verify（推荐）
```powershell
powershell -ExecutionPolicy Bypass -File scripts\verify.ps1
```
或：
```bash
bash scripts/verify.sh
```

6) 基础仓库门禁（Lite 默认；workflow/contract/doc-index + lite scenario）
```powershell
powershell -ExecutionPolicy Bypass -File scripts\verify_repo.ps1
```
或：
```bash
bash scripts/verify_repo.sh
```

---

## What “Team Mode” Produces

- `meta/tasks/CURRENT.md`：本次任务单（验收、计划、是否允许改代码）
- `meta/externals/*`：外部方案对比（如果需要）
- `${CTCP_RUNS_ROOT:-~/.ctcp/runs}/ctcp/<run_id>/`：一次运行的“团队包”（真实产物目录）
  - `PROMPT.md`：给 coding agent 的唯一输入
  - `QUESTIONS.md`：只允许写阻塞性问题
  - `TRACE.md`：全过程记录（演示用）
- `meta/run_pointers/LAST_RUN.txt`：仓库内指针，指向最新外部 run 包绝对路径
- `meta/reports/LAST.md`：面向你的最终演示报告（可回放/可审计）

---

## Build

默认 headless 构建：

```powershell
cmake -S . -B build_lite -DCTCP_ENABLE_GUI=OFF
cmake --build build_lite --config Release
```

GUI 示例构建（可选）：

```powershell
cmake -S . -B build_gui -DCTCP_ENABLE_GUI=ON -DCMAKE_PREFIX_PATH="<Qt path>"
cmake --build build_gui --config Release
```

更多见 `BUILD.md`。

---

## Doc Index

<!-- CTCP:DOC_INDEX:BEGIN -->
<!-- (auto-generated by scripts/sync_doc_links.py; curated list) -->

## Project Docs

- [AGENTS.md](AGENTS.md)
- [README.md](README.md)
- [BUILD.md](BUILD.md)
- [PATCH_README.md](PATCH_README.md)
- [TREE.md](TREE.md)
- [docs/00_CORE.md](docs/00_CORE.md)
- [docs/00_overview.md](docs/00_overview.md)
- [docs/01_architecture.md](docs/01_architecture.md)
- [docs/02_workflow.md](docs/02_workflow.md)
- [docs/03_quality_gates.md](docs/03_quality_gates.md)
- [docs/10_team_mode.md](docs/10_team_mode.md)
- [docs/21_paths_and_locations.md](docs/21_paths_and_locations.md)
- [docs/22_teamnet_adlc.md](docs/22_teamnet_adlc.md)
- [docs/22_agent_teamnet.md](docs/22_agent_teamnet.md)
- [docs/30_artifact_contracts.md](docs/30_artifact_contracts.md)
- [docs/12_modules_index.md](docs/12_modules_index.md)
- [docs/13_contracts_index.md](docs/13_contracts_index.md)
- [docs/SELF_CHECK_SYSTEM.md](docs/SELF_CHECK_SYSTEM.md)
- [ai_context/00_AI_CONTRACT.md](ai_context/00_AI_CONTRACT.md)

<!-- CTCP:DOC_INDEX:END -->

---

## Notes

- 本仓库默认 **Spec-first**：先改 docs/spec/meta，再改代码。
- “禁止代码”由 `scripts/workflow_checks.py` 强制执行（不满足直接 fail）。
